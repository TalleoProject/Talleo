set(UPNPC_BUILD_STATIC ON CACHE BOOL "Build static library")
set(UPNPC_BUILD_SHARED OFF CACHE BOOL "Build shared library")
set(UPNPC_BUILD_TESTS OFF CACHE BOOL "Build test executables")
set(WITH_MD_LIBRARY OFF CACHE BOOL "Code Generation for static library")

if(NOT MINIUPNPC_FOUND)
  add_subdirectory(miniupnpc)
endif()

if (DO_TESTS)
  add_subdirectory(gtest)
endif()

if(MSVC)
    include_directories(${gtest_SOURCE_DIR}/include ${gtest_SOURCE_DIR} ../version)
    add_subdirectory(rocksdb EXCLUDE_FROM_ALL)
    set_property(TARGET rocksdb PROPERTY FOLDER "external")
elseif(NOT ROCKSDB_FOUND)
    add_subdirectory(rocksdb EXCLUDE_FROM_ALL)
endif()

if(MINIUPNPC_FOUND)
  add_library(upnpc-static STATIC IMPORTED GLOBAL)
  set_target_properties(upnpc-static PROPERTIES IMPORTED_LOCATION ${MINIUPNPC_LIBRARIES})
else()
  set_property(TARGET upnpc-static PROPERTY FOLDER "external")
  if(MSVC)
    set_property(TARGET upnpc-static APPEND_STRING PROPERTY COMPILE_FLAGS " -wd4244 -wd4267")
  elseif(NOT MSVC)
    set_property(TARGET upnpc-static APPEND_STRING PROPERTY COMPILE_FLAGS " -Wno-undef -Wno-unused-result -Wno-unused-value")
  endif()
endif()

if(DO_TESTS)
  set_property(TARGET gtest gtest_main PROPERTY FOLDER "external")
endif()

